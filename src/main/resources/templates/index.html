<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>KHTeam3 DCIM System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="/css/index.css" rel="stylesheet">
</head>
<body>

<!-- 네비게이션 헤더 -->
<div th:replace="~{fragments/header :: header}"></div>

<!-- 1. 메인 히어로 슬라이드 -->
<div class="position-relative main-slider-wrapper">
    <!-- 슬라이드 파일 불러오기 -->
    <div th:replace="~{main/slide :: slide}"></div>

    <!-- (이전 날씨 위젯 제거됨) -->
</div>

<!-- 2. 핵심 요약 띠 (Summary Strip) -->
<div class="bg-dark text-white py-4 shadow">
    <div class="container">
        <div class="row text-center g-4">

            <!-- (1) 총 랙 (증가 추세) -->
            <div class="col-md-3 border-end border-secondary">
                <h6 class="text-secondary text-uppercase mb-2">Total Racks</h6>
                <h2 class="fw-bold">
                    <i class="bi bi-hdd-rack text-primary"></i> [[${totalRacks}]]
                    <!-- ⭐ 추세 표시 -->
                    <span class="trend-badge trend-neutral" title="변동 없음"><i class="bi bi-dash"></i></span>
                </h2>
            </div>

            <!-- (2) 총 장비 (증가 추세) -->
            <div class="col-md-3 border-end border-secondary">
                <h6 class="text-secondary text-uppercase mb-2">Total Devices</h6>
                <h2 class="fw-bold">
                    <i class="bi bi-server text-success"></i> [[${stats.totalDevices}]]
                    <!-- ⭐ 추세 표시 (하드코딩 예시: +5) -->
                    <span class="trend-badge trend-up" title="전월 대비 증가"><i class="bi bi-arrow-up-short"></i> 5</span>
                </h2>
            </div>

            <!-- (3) PUE 지수 (감소=좋음 추세) -->
            <div class="col-md-3 border-end border-secondary">
                <h6 class="text-secondary text-uppercase mb-2">Power Usage (PUE)</h6>
                <h2 class="fw-bold text-info">
                    <i class="bi bi-lightning-charge"></i> [[${stats.pue}]]
                    <!-- ⭐ 추세 표시 (하드코딩 예시: -0.02 개선됨) -->
                    <span class="trend-badge trend-down" title="효율 개선됨"><i class="bi bi-arrow-down-short"></i> 0.02</span>
                </h2>
            </div>

            <!-- (4) 데이터센터 환경 정보 (날씨) - 위치 변경됨 -->
            <div class="col-md-3">
                <h6 class="text-secondary text-uppercase mb-2">Environment (Seoul)</h6>
                <h2 class="fw-bold text-warning">
                    <i class="bi bi-cloud-sun"></i> 24℃
                    <!-- 습도 및 냉방 부하 표시 -->
                    <span class="fs-6 text-white-50 ms-2" title="Humidity">
                        <i class="bi bi-droplet-fill text-primary"></i> 45%
                    </span>
                </h2>
            </div>
        </div>
    </div>
</div>

<!-- 3. 상세 대시보드 (Charts & Metrics) -->
<div class="container py-5">
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h3 class="fw-bold text-dark">Data Center Overview</h3>
            <p class="text-muted">실시간 자산 현황 및 에너지 효율 모니터링</p>
            <hr class="w-25 mx-auto text-primary" style="height: 3px; opacity: 1;">
        </div>
    </div>

    <div class="row g-4">
        <!-- [왼쪽] 자산 분류 -->
        <div class="col-lg-4">
            <div class="stat-card p-4">
                <h5 class="fw-bold mb-4 border-start border-4 border-primary ps-3">자산 분류 (Type)</h5>
                <div class="chart-box">
                    <canvas id="typeChart"></canvas>
                </div>
                <div class="mt-4 text-center d-flex justify-content-around small fw-bold">
                    <span class="text-success"><i class="bi bi-circle-fill"></i> SVR: [[${stats.svrCount}]]</span>
                    <span class="text-warning"><i class="bi bi-circle-fill"></i> NET: [[${stats.netCount}]]</span>
                    <span class="text-info"><i class="bi bi-circle-fill"></i> STO: [[${stats.stoCount}]]</span>
                    <span style="color: #6f42c1"><i class="bi bi-circle-fill"></i> UPS: [[${stats.upsCount}]]</span>
                </div>
            </div>
        </div>

        <!-- [가운데] 공간 및 에너지 -->
        <div class="col-lg-4">
            <div class="stat-card p-4 d-flex flex-column justify-content-center">
                <h5 class="fw-bold mb-4 border-start border-4 border-warning ps-3">공간 및 에너지 효율</h5>

                <div class="mb-4">
                    <div class="d-flex justify-content-between mb-1">
                        <span class="fw-bold text-muted">Rack Space Usage</span>
                        <span class="fw-bold text-primary">[[${stats.spaceUsage}]]%</span>
                    </div>
                    <div class="progress" style="height: 20px; border-radius: 10px;">
                        <div class="progress-bar progress-bar-striped progress-bar-animated bg-primary"
                             role="progressbar" th:style="'width: ' + ${stats.spaceUsage} + '%'"></div>
                    </div>
                    <small class="text-muted mt-1 d-block text-end">
                        사용: [[${stats.usedSpace}]]U / 잔여: [[${stats.emptySpace}]]U
                    </small>
                </div>

                <div class="row text-center mt-2 g-3">
                    <div class="col-6">
                        <div class="p-3 bg-light rounded-3 border">
                            <i class="bi bi-plug-fill text-danger fs-3"></i>
                            <h5 class="fw-bold mt-2 mb-0">[[${stats.itPower}]] W</h5>
                            <small class="text-muted">IT Load</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="p-3 bg-light rounded-3 border">
                            <i class="bi bi-activity text-success fs-3"></i>
                            <h5 class="fw-bold mt-2 mb-0">[[${stats.emsCount}]] EA</h5>
                            <small class="text-muted">EMS Linked</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- [오른쪽] 가동 현황 -->
        <div class="col-lg-4">
            <div class="stat-card p-4">
                <!-- ⭐ [NEW] 실시간 점멸 표시 (Live Indicator) -->
                <h5 class="fw-bold mb-4 border-start border-4 border-success ps-3">
                    가동 현황 <span class="live-indicator ms-2" title="실시간 모니터링 중"></span>
                </h5>

                <div class="chart-box">
                    <canvas id="statusChart"></canvas>
                </div>
                <div class="mt-4 text-center">
                    <span class="badge bg-success bg-opacity-10 text-success fs-6 me-2 px-3 py-2">
                        ON : [[${stats.onCount}]]
                    </span>
                    <span class="badge bg-danger bg-opacity-10 text-danger fs-6 px-3 py-2">
                        OFF : [[${stats.offCount}]]
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- 최근 로그 -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-white py-3">
                    <h5 class="mb-0 fw-bold text-secondary"><i class="bi bi-clock-history"></i> Recent System Activity</h5>
                </div>
                <div class="card-body p-0">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                        <tr><th>Time</th><th>User</th><th>Activity</th></tr>
                        </thead>
                        <tbody>
                        <tr th:each="log : ${recentLogs}">
                            <td th:text="${#temporals.format(log.timestamp, 'yyyy-MM-dd HH:mm')}"></td>
                            <td><span class="badge bg-secondary" th:text="${log.actor}"></span></td>
                            <td th:text="${log.actionDescription}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 5. 푸터 (분리됨) -->
<div th:replace="~{fragments/footer :: footer}"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/index.js"></script>

<script th:inline="javascript">
    /*<![CDATA[*/
    const chartData = {
        svr: [[${stats.svrCount}]],
        net: [[${stats.netCount}]],
        sto: [[${stats.stoCount}]],
        ups: [[${stats.upsCount}]],
        on:  [[${stats.onCount}]],
        off: [[${stats.offCount}]]
    };
    document.addEventListener("DOMContentLoaded", function() {
        initDashboardCharts(chartData);
    });
    /*]]>*/
</script>

</body>
</html>