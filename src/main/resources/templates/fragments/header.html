<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Header Fragment</title>
    <!-- 부트스트랩 & 아이콘 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- StarRoot 전용 폰트 -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&display=swap" rel="stylesheet">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark navbar-custom" th:fragment="header">
    <div class="container">
        <!-- 로고 -->
        <a class="navbar-brand brand-logo" href="/">
            <i class="bi bi-stars text-info me-1"></i>StarRoot
        </a>

        <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto align-items-center">

                <!-- 1-1. 관리 정보 -->
                <li class="nav-item dropdown">
                    <a class="nav-link nav-link-custom dropdown-toggle" href="#" id="navbarDropdown1" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-grid-fill me-1"></i> 장비 제원
                    </a>
                    <ul class="dropdown-menu dropdown-menu-custom" aria-labelledby="navbarDropdown1">
                        <li><a class="dropdown-item dropdown-item-custom" href="/specs/racks"><i class="bi bi-terminal-split me-2 text-info"></i>랙 장비</a></li>
                        <li><a class="dropdown-item dropdown-item-custom" href="/specs/servers"><i class="bi bi-router me-2 text-danger"></i>서버 장비</a></li>
                        <li><a class="dropdown-item dropdown-item-custom" href="/specs/power"><i class="bi bi-plugin me-2 text-warning"></i>배전 장치</a></li>
                        <li><a class="dropdown-item dropdown-item-custom" href="/specs/cooling"><i class="bi bi-thermometer-snow me-2 text-primary"></i>공조 장치</a></li>
                    </ul>
                </li>

                <!-- 1-2. 관리 정보 -->
                <li class="nav-item dropdown">
                    <a class="nav-link nav-link-custom dropdown-toggle" href="#" id="navbarDropdown2" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-grid-fill me-1"></i> 관리 정보
                    </a>
                    <ul class="dropdown-menu dropdown-menu-custom" aria-labelledby="navbarDropdown2">
                        <li><a class="dropdown-item dropdown-item-custom" href="/solutions/racks"><i class="bi bi-hdd-rack me-2 text-info"></i>랙 관리</a></li>
                        <li><a class="dropdown-item dropdown-item-custom" href="/solutions/assets"><i class="bi bi-qr-code-scan me-2 text-danger"></i>실시간 현황 관리</a></li>
                        <li><a class="dropdown-item dropdown-item-custom" href="/solutions/power"><i class="bi bi-lightning-charge me-2 text-warning"></i>전력 모니터링</a></li>
                        <li><a class="dropdown-item dropdown-item-custom" href="/solutions/cooling"><i class="bi bi-snow me-2 text-primary"></i>냉방 시스템</a></li>
                    </ul>
                </li>

                <!-- 1-3. 이용 약관 및 조건 -->
                <li class="nav-item dropdown">
                    <a class="nav-link nav-link-custom dropdown-toggle" href="#" id="navbarDropdown3" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-grid-fill me-1"></i> 이용 약관 및 조건
                    </a>
                    <ul class="dropdown-menu dropdown-menu-custom" aria-labelledby="navbarDropdown3">
                        <li><a class="dropdown-item dropdown-item-custom" href="/info/terms"><i class="bi bi-info-square me-2 text-info"></i>이용 약관</a></li>
                        <li><a class="dropdown-item dropdown-item-custom" href="/info/legal"><i class="bi bi-journal-text me-2 text-danger"></i>법적 고지</a></li>
                        <li><a class="dropdown-item dropdown-item-custom" href="/info/privacy"><i class="bi bi-person-check me-2 text-warning"></i>개인정보처리방침</a></li>
                        <li><a class="dropdown-item dropdown-item-custom" href="/info/contact"><i class="bi bi-headset me-2 text-primary"></i>고객센터</a></li>
                    </ul>
                </li>

                <!-- 2. 장비 -->
                <li class="nav-item dropdown" sec:authorize="hasRole('USER')">
                    <a class="nav-link nav-link-custom dropdown-toggle" href="#" id="navbarDropdown4" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-hdd-stack me-2"></i> 장비
                    </a>
                    <ul class="dropdown-menu dropdown-menu-custom" aria-labelledby="navbarDropdown4">
                        <li sec:authorize="!hasRole('ADMIN')">
                            <a class="dropdown-item dropdown-item-custom" href="/requests/new">
                                <i class="bi-plus-circle-dotted me-2 text-success"></i>장비 입고 신청
                            </a>
                        </li>
                        <li sec:authorize="!hasRole('ADMIN')">
                            <a class="dropdown-item dropdown-item-custom" href="/requests/my">
                                <i class="bi-clock-history me-2 text-success"></i>나의 입고 이력
                            </a>
                        </li>
                    </ul>
                </li>

<!--                &lt;!&ndash; 2. 입고 신청 &ndash;&gt;-->
<!--                <li class="nav-item" sec:authorize="!hasRole('ADMIN')">-->
<!--                    <a class="nav-link nav-link-custom" href="/requests/new">-->
<!--                        <i class="bi bi-pencil-square me-1"></i> 장비 입고 신청-->
<!--                    </a>-->
<!--                </li>-->

                <!-- 3. 사용자 정보 (디자인 개선됨) -->
                <li class="nav-item dropdown" sec:authorize="isAuthenticated()">
                    <a class="nav-link nav-link-custom dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">

                        <!-- ⭐️ 프로필 이미지 / 기본 아바타 로직 ⭐️ -->
                        <th:block th:if="${#authentication.principal instanceof T(com.example.KHTeam3DCIM.security.CustomUserDetails)}">

                            <!-- Case A: 사용자가 등록한 이미지가 있는 경우 -->
                            <img th:if="${#authentication.principal.profileImage != null}"
                                 th:src="@{/uploads/{img}(img=${#authentication.principal.profileImage})}"
                                 class="rounded-circle me-2"
                                 style="width: 35px; height: 35px; object-fit: cover; border: 2px solid rgba(255,255,255,0.2); box-shadow: 0 0 10px rgba(0,0,0,0.3);"
                                 alt="Profile">

                            <!-- Case B: 이미지가 없는 경우 (기본값: 멋진 그라데이션 원형 아이콘) -->
                            <!-- 테두리에 Cyan 네온 효과를 주고, 내부는 어두운 배경으로 처리하여 전문가 느낌을 줍니다 -->
                            <div th:unless="${#authentication.principal.profileImage != null}"
                                 class="rounded-circle me-2 d-flex align-items-center justify-content-center"
                                 style="width: 35px; height: 35px;
                                        background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
                                        border: 2px solid var(--accent-cyan);
                                        box-shadow: 0 0 8px rgba(6, 182, 212, 0.4);">
                                <i class="bi bi-person-fill" style="font-size: 1.2rem; color: var(--accent-cyan);"></i>
                            </div>
                        </th:block>

                        <!-- Case C: 예외 처리 (CustomUserDetails가 아닐 때) -->
                        <th:block th:unless="${#authentication.principal instanceof T(com.example.KHTeam3DCIM.security.CustomUserDetails)}">
                            <div class="rounded-circle me-2 d-flex align-items-center justify-content-center"
                                 style="width: 35px; height: 35px; background: #334155; border: 1px solid #475569;">
                                <i class="bi bi-person-fill text-white"></i>
                            </div>
                        </th:block>

                        <span class="fw-bold"
                              style="text-shadow: 0 0 10px rgba(255,255,255,0.2);"
                              th:text="${#authentication.principal instanceof T(com.example.KHTeam3DCIM.security.CustomUserDetails)
                                ? #authentication.principal.name
                                : #authentication.principal.username}">User</span> 님
                    </a>

                    <ul class="dropdown-menu dropdown-menu-custom dropdown-menu-end" aria-labelledby="userDropdown">
                        <li sec:authorize="hasRole('ADMIN')">
                            <a class="dropdown-item dropdown-item-custom" th:href="@{/admin}">
                                <i class="bi bi-speedometer2 me-2 text-danger"></i> 관리자 페이지
                            </a>
                        </li>
                        <li sec:authorize="hasRole('USER')">
                            <a class="dropdown-item dropdown-item-custom" href="/members/edit">
                                <i class="bi bi-gear me-2 text-info"></i> 내 정보
                            </a>
                        </li>
                        <li><hr class="dropdown-divider" style="border-color: rgba(255,255,255,0.1);"></li>
                        <li>
                            <a class="dropdown-item dropdown-item-custom" th:href="@{/members/logout}">
                                <i class="bi bi-box-arrow-right me-2 text-secondary"></i> 로그아웃
                            </a>
                        </li>
                    </ul>
                </li>

                <!-- 4. 로그인/회원가입 -->
                <li class="nav-item" sec:authorize="!isAuthenticated()">
                    <a class="nav-link nav-link-custom" href="/members/login">
                        <i class="bi bi-box-arrow-in-right me-1"></i> 로그인
                    </a>
                </li>
                <li class="nav-item" sec:authorize="!isAuthenticated()">
                    <a class="nav-link nav-link-custom" href="/members/signup">
                        <i class="bi bi-person-plus me-1"></i> 회원가입
                    </a>
                </li>

            </ul>
        </div>
    </div>
</nav>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>